sudo su - root

apt update

# installer k3s
curl -sfL https://get.k3s.io | sh -


# récupérer la config kube du server local
mkdir -p ~/.kube
cp /etc/rancher/k3s/k3s.yaml ~/.kube/config

# installer nerdctl 
NERDCTL_VERSION="1.7.7"
wget "https://github.com/containerd/nerdctl/releases/download/v${NERDCTL_VERSION}/nerdctl-full-${NERDCTL_VERSION}-linux-amd64.tar.gz"
sudo tar Cxzvvf /usr/local - < nerdctl-full-${NERDCTL_VERSION}-linux-amd64.tar.gz
sudo systemctl enable --now buildkit
mkdir -p ~/.config/nerdctl
cat <<EOF > ~/.config/nerdctl/nerdctl.toml
address = "/run/k3s/containerd/containerd.sock"
namespace = "k8s.io"
EOF

# installer skaffold
curl -Lo skaffold https://storage.googleapis.com/skaffold/releases/latest/skaffold-linux-amd64
sudo install skaffold /usr/local/bin/
rm skaffold


# stocker les credentials git pour les entrer une seule fois
git config --global credential.helper "cache --timeout=3600"

# cloner le frontend client
git clone https://iut-git.unice.fr/simon/simon

# cloner les dépôts IOT
mkdir iot
cd iot
git clone https://iut-git.unice.fr/simon/iot/capteur
git clone https://iut-git.unice.fr/simon/iot/passerelle

# cloner les API
cd ..
mkdir APIs
cd APIs
git clone https://iut-git.unice.fr/simon/services/api-capteur
git clone https://iut-git.unice.fr/simon/services/api-ingestion
git clone https://iut-git.unice.fr/simon/services/serviceauthent